<!doctype html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/base.html}">

<div layout:fragment="content" class="col-9 mx-auto" style="margin-top: 100px; margin-bottom: 130px;">
    <div>
        <h3 class="mb-2 text-center" style="color: #333;">ì•„í‹°ìŠ¤íŠ¸ ì‹ ì²­í•˜ê¸°</h3>
        <hr class="mb-6" style="margin-bottom: 40px; margin-top: 40px; border: 1px solid #555;">

        <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
        <p class="text-center mb-3" style="color: #666; font-size: 14px;">
            ì•„ì§ ë“±ë¡ë˜ì§€ ì•Šì€ ì•„í‹°ìŠ¤íŠ¸ì˜ ì•¨ë²” ì‹ ì²­ì€ ì•„í‹°ìŠ¤íŠ¸ ë“±ë¡ ì´í›„ì— ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>ì œì¶œí•´ì£¼ì‹  í¼ì€ ê´€ë¦¬ì í™•ì¸ í›„ ìŠ¹ì¸ì´ ê²°ì •ë©ë‹ˆë‹¤.
        </p>
        <p class="text-center mb-5" style="color: #ff4d4d; font-size: 14px;">
            ëª¨ë“  í•­ëª©ì„ ìµœëŒ€í•œ ì •í™•í•˜ê³  ìì„¸í•˜ê²Œ ì ì–´ì£¼ì‹œë©´ ë¹ ë¥¸ ë“±ë¡ì— ë„ì›€ì´ ë©ë‹ˆë‹¤!ğŸ™‡
        </p>

        <form id="artistForm" th:action="@{/support/artist-request}" method="post" enctype="multipart/form-data" class="col-6 mx-auto needs-validation" novalidate>
            <!-- ì•„í‹°ìŠ¤íŠ¸ ì´ë¦„ -->
            <div class="row mb-4 align-items-center">
                <label for="artistName" class="col-md-3 col-form-label text-md-end font-weight-bold">
                    ì•„í‹°ìŠ¤íŠ¸ ì´ë¦„ <span style="color: red;">*</span>:
                </label>
                <div class="col-md-9">
                    <input id="artistName" name="name" type="text" class="form-control" placeholder="ì•„í‹°ìŠ¤íŠ¸ ëª…ì„ ì…ë ¥í•˜ì„¸ìš”." required />
                    <!--<div class="invalid-feedback">ì•„í‹°ìŠ¤íŠ¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.</div>-->
                </div>
            </div>

            <!-- íƒ€ì… -->
            <div class="row mb-4 align-items-center">
                <label class="col-md-3 col-form-label text-md-end font-weight-bold">
                    íƒ€ì… <span style="color: red;">*</span>:
                </label>
                <div class="col-md-9">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="type" id="typeIndividual" value="person" checked onclick="toggleGender(true)" />
                        <label class="form-check-label" for="typeIndividual">ê°œì¸</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="type" id="typeGroup" value="group" onclick="toggleGender(false)" />
                        <label class="form-check-label" for="typeGroup">ê·¸ë£¹</label>
                    </div>
                </div>
            </div>

            <!-- ì„±ë³„ -->
            <div class="row mb-4 align-items-center" id="genderSection">
                <label class="col-md-3 col-form-label text-md-end font-weight-bold">
                    ì„±ë³„ <span style="color: red;">*</span>:
                </label>
                <div class="col-md-9">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="gender" id="genderMale" value="male" />
                        <label class="form-check-label" for="genderMale">ë‚¨ì„±</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="gender" id="genderFemale" value="female" />
                        <label class="form-check-label" for="genderFemale">ì—¬ì„±</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="gender" id="genderUnknown" value="" />
                        <label class="form-check-label" for="genderUnknown">ì•Œ ìˆ˜ ì—†ìŒ</label>
                    </div>
                </div>
            </div>

            <!-- êµ­ê°€ -->
            <div class="row mb-4 align-items-center">
                <label for="country" class="col-md-3 col-form-label text-md-end font-weight-bold">
                    êµ­ê°€ <span style="color: red;">*</span>:
                </label>
                <div class="col-md-9 d-flex align-items-center">
                    <select id="country" name="country" class="form-select" style="width: 40%;" onchange="handleCountryChange()" required>
                        <option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>
                        <!-- countries ë°˜ë³µ -->
                        <option th:each="country : ${countries}" th:value="${country.country}" th:text="${country.country}">
                        </option>
                        <option value="other">âŒê·¸ ì™¸ êµ­ê°€</option>
                    </select>
                    <!-- ë™ì ìœ¼ë¡œ í‘œì‹œë  ì…ë ¥ í•„ë“œ -->
                    <input type="text" id="otherCountryInput" name="otherCountry" class="form-control ms-3"
                           placeholder="êµ­ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="display: none; width: 40%;">
                </div>
            </div>


            <!-- ìƒë…„ì›”ì¼ -->
            <div class="row mb-4 align-items-center">
                <label id="birthLabel" class="col-md-3 col-form-label text-md-end font-weight-bold">
                    ìƒë…„ì›”ì¼ <span style="color: red;">*</span>:
                </label>
                <div class="col-md-9">
                    <div class="d-flex align-items-center">
                        <input type="number" id="birthYear" class="form-control" placeholder="ë…„(4ìë¦¬)" style="width: 30%;" required />
                        <span class="mx-2">/</span>
                        <select id="birthMonth" class="form-select" style="width: 25%;" required>
                            <option value="">ì›”</option>
                            <th:block th:each="month : ${#numbers.sequence(1,12)}">
                                <option th:value="${month}" th:text="${month}"></option>
                            </th:block>
                        </select>
                        <span class="mx-2">/</span>
                        <select id="birthDay" class="form-select" style="width: 25%;" required>
                            <option value="">ì¼</option>
                            <th:block th:each="day : ${#numbers.sequence(1,31)}">
                                <option th:value="${day}" th:text="${day}"></option>
                            </th:block>
                        </select>
                    </div>
                    <div class="invalid-feedback">ìƒë…„ì›”ì¼ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.</div>
                </div>
            </div>

            <!-- ì•„í‹°ìŠ¤íŠ¸ ì‚¬ì§„ -->
            <div class="row mb-4 align-items-center">
                <label for="artistPhoto" class="col-md-3 col-form-label text-md-end font-weight-bold">
                    ì•„í‹°ìŠ¤íŠ¸ ì‚¬ì§„ <span style="color: red;">*</span>:
                </label>
                <div class="col-md-9 d-flex align-items-center">
                    <input id="artistPhoto" name="image" type="file" class="form-control" accept="image/*" onchange="limitFileUpload(this)" required/>
                    <button type="button" class="btn btn-dark btn-sm ms-2" tabindex="0" data-bs-toggle="popover" data-bs-trigger="hover"
                            data-bs-content="ìµœëŒ€í•œ ì˜ ë‚˜ì˜¨ ì‚¬ì§„ìœ¼ë¡œ ì˜¬ë ¤ì£¼ì„¸ìš”!">
                        ?
                    </button>
                </div>
            </div>

            <!-- íƒœê·¸ -->
            <div class="row mb-4 align-items-center">
                <label for="tags" class="col-md-3 col-form-label text-md-end font-weight-bold">
                    íƒœê·¸:
                </label>
                <div class="col-md-9 d-flex align-items-center">
                    <input id="tags" name="tags" type="text" class="form-control" placeholder="íƒœê·¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”." />
                    <button type="button" class="btn btn-dark btn-sm ms-2" tabindex="0" data-bs-toggle="popover" data-bs-html="true" data-bs-trigger="hover"
                            data-bs-content="íƒœê·¸ëŠ” ì•„í‹°ìŠ¤íŠ¸ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í‚¤ì›Œë“œì…ë‹ˆë‹¤.<br>,ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚˜ëˆ ì£¼ì„¸ìš”.<br>(ex. ë¶ë±,ì»¨ì…”ìŠ¤ ë©,ì˜¬í•´ì˜ ì•„í‹°ìŠ¤íŠ¸ ìˆ˜ìƒ)">
                        ?
                    </button>
                </div>
            </div>

            <!-- ì¸ìŠ¤íƒ€ê·¸ë¨ ì•„ì´ë”” -->
            <div class="row mb-4 align-items-center">
                <label for="instaId" class="col-md-3 col-form-label text-md-end font-weight-bold">
                    ì¸ìŠ¤íƒ€ê·¸ë¨ ID:
                </label>
                <div class="col-md-9">
                    <input id="instaId" name="instaId" type="text" class="form-control" placeholder="ì¸ìŠ¤íƒ€ê·¸ë¨ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.">
                </div>
            </div>

            <!-- íŠ¸ìœ„í„° ì•„ì´ë”” -->
            <div class="row mb-4 align-items-center">
                <label for="twitterId" class="col-md-3 col-form-label text-md-end font-weight-bold">
                    íŠ¸ìœ„í„° ID:
                </label>
                <div class="col-md-9">
                    <input id="twitterId" name="twitterId" type="text" class="form-control" placeholder="íŠ¸ìœ„í„° IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.">
                </div>
            </div>

            <!-- ê¸°íƒ€ í•˜ê³ ì‹¶ì€ ë§ -->
            <div class="row mb-4 align-items-center">
                <label for="note" class="col-md-3 col-form-label text-md-end font-weight-bold">
                    ê¸°íƒ€ í•˜ê³ ì‹¶ì€ ë§:
                </label>
                <div class="col-md-9">
                    <textarea id="note" name="note" class="form-control" rows="3"></textarea>
                </div>
            </div>

            <!-- ì œì¶œ ë²„íŠ¼ -->
            <div class="row">
                <div class="col-md-9 offset-md-3 text-end">
                    <button type="button" class="btn btn-dark rounded-pill" onclick="validateAndSubmitForm()">
                        ì œì¶œ
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- ì‹ ì²­ ì™„ë£Œ Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center" style="line-height: 1.7; padding: 20px; margin-bottom: 0px;">
                    ì œì¶œí•˜ì‹  ì•„í‹°ìŠ¤íŠ¸ ì •ë³´ê°€ ì‹ ì²­ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                    ê´€ë¦¬ì ê²€í†  í›„ ì—…ë¡œë“œë˜ë©°, í˜„í™©ì€ <br><strong>ë§ˆì´í˜ì´ì§€ &gt; ì•„í‹°ìŠ¤íŠ¸ ì‹ ì²­ëª©ë¡</strong>ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
                <div class="modal-footer" style="justify-content: center; padding-top: 0;">
                    <button type="button" class="btn" data-bs-dismiss="modal" style="background-color: black; color: white; border-radius: 0; padding: 8px 18px;">
                        ë‹«ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>

</div>

<script layout:fragment="script" th:inline="javascript">

    var result = /*[[${success}]]*/ false;
    if (result) {
        var modal = new bootstrap.Modal(document.querySelector("#successModal"));
        modal.show();
    }

    function handleCountryChange() {
        const countrySelect = document.getElementById('country');
        const otherCountryInput = document.getElementById('otherCountryInput');

        // "ê·¸ ì™¸ êµ­ê°€"ê°€ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
        if (countrySelect.value === 'other') {
            otherCountryInput.style.display = 'block';
            otherCountryInput.required = true; // í•„ìˆ˜ ì…ë ¥ ì„¤ì •
        } else {
            otherCountryInput.style.display = 'none';
            otherCountryInput.required = false; // í•„ìˆ˜ ì…ë ¥ í•´ì œ
            otherCountryInput.value = ''; // ì…ë ¥ê°’ ì´ˆê¸°í™”
        }
    }

    function limitFileUpload(input) {
        if (input.files.length > 1) {
            alert("í•œ ë²ˆì— 1ì¥ì˜ ì‚¬ì§„ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            input.value = ""; // ì„ íƒ ì´ˆê¸°í™”
        }
    }

    function toggleGender(enable) {
        const genderRadios = document.querySelectorAll('[name="gender"]');
        genderRadios.forEach(radio => {
            radio.disabled = !enable; // ì„±ë³„ í•„ë“œ í™œì„±í™”/ë¹„í™œì„±í™”
            radio.required = enable; // ì„±ë³„ í•„ë“œì˜ required ì„¤ì •
            if (!enable) {
                radio.checked = false; // ì²´í¬ í•´ì œ
            }
        });

        // ìƒë…„ì›”ì¼/í™œë™ ì‹œì‘ì¼ ë ˆì´ë¸” ì—…ë°ì´íŠ¸
        const birthLabel = document.getElementById('birthLabel');
        birthLabel.textContent = enable
            ? 'ìƒë…„ì›”ì¼ '
            : 'í™œë™ ì‹œì‘ì¼ ';
        birthLabel.innerHTML += '<span style="color: red;">*</span>:';
    }

    function validateAndSubmitForm() {
        const form = document.getElementById('artistForm');
        const typeIndividual = document.getElementById('typeIndividual').checked;
        const countrySelect = document.getElementById('country');
        const otherCountryInput = document.getElementById('otherCountryInput');

        // ì„±ë³„ í•„ë“œì— ëŒ€í•´ ì¡°ê±´ì— ë”°ë¼ required ì„¤ì •
        toggleGender(typeIndividual);

        // "ê·¸ ì™¸ êµ­ê°€"ê°€ ì„ íƒëœ ê²½ìš° ì…ë ¥ê°’ì„ country í•„ë“œë¡œ ì„¤ì •
        if (countrySelect.value === 'other') {
            if (otherCountryInput.value.trim() === '') {
                // ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ ì‹œ ê²½ê³  í‘œì‹œ
                alert('êµ­ê°€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                otherCountryInput.focus();
                return;
            }

            // ì…ë ¥í•œ ê°’ì„ í¼ ë°ì´í„°ë¡œ í¬í•¨ì‹œí‚¤ê¸° ìœ„í•´ íˆë“  í•„ë“œë¡œ ì¶”ê°€
            const customCountryInput = document.createElement('input');
            customCountryInput.type = 'hidden';
            customCountryInput.name = 'country';
            customCountryInput.value = otherCountryInput.value.trim();
            form.appendChild(customCountryInput);

            // ê¸°ì¡´ `country` selectì˜ ê°’ì„ ì œê±°í•˜ê±°ë‚˜ ë¬´íš¨í™”
            countrySelect.name = ''; // ì „ì†¡ë˜ì§€ ì•Šë„ë¡ ì„¤ì •
        }

        if (!form.checkValidity()) {
            form.classList.add('was-validated');
            return;
        }

        const genderUnknown = document.getElementById('genderUnknown');
        if (genderUnknown.checked) {
            genderUnknown.name = ""; // ì „ì†¡ë˜ì§€ ì•Šë„ë¡ name ì†ì„± ì œê±°
        } else {
            genderUnknown.name = "gender"; // ë‹¤ì‹œ ì„¤ì •í•˜ì—¬ ì „ì†¡ ê°€ëŠ¥í•˜ë„ë¡ í•¨
        }

        const birthYear = document.getElementById('birthYear').value;
        const birthMonth = document.getElementById('birthMonth').value;
        const birthDay = document.getElementById('birthDay').value;
        const bornedIn = `${birthYear}-${birthMonth.padStart(2, '0')}-${birthDay.padStart(2, '0')}`;

        const birthYearNumber = parseInt(birthYear, 10);
        const birthLabelText = typeIndividual ? "ìƒë…„ì›”ì¼" : "í™œë™ ì‹œì‘ì¼";

        // ìƒë…„ì›”ì¼/í™œë™ ì‹œì‘ì¼ ìœ íš¨ì„± ê²€ì‚¬
        if (isNaN(birthYearNumber) || birthYearNumber < 1500 || birthYear.length !== 4) {
            alert(`ì˜¬ë°”ë¥¸ ${birthLabelText}ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.`);
            document.getElementById('birthYear').focus();
            return;
        }

        const confirmation = confirm("ëª¨ë“  ë‚´ìš©ì´ ì •í™•í•©ë‹ˆê¹Œ?");
        if (confirmation) {
            const bornedInInput = document.createElement('input');
            bornedInInput.type = 'hidden';
            bornedInInput.name = 'bornedIn';
            bornedInInput.value = bornedIn;
            form.appendChild(bornedInInput);

            form.submit();
        }
    }

    // Bootstrap Popovers ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function () {
        const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
        popoverTriggerList.forEach(function (popoverTriggerEl) {
            new bootstrap.Popover(popoverTriggerEl, {
                trigger: 'hover'
            });
        });
    });
</script>
</html>
